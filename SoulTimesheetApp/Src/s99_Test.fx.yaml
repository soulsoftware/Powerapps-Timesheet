s99_Test As screen:
    LoadingSpinnerColor: =RGBA(98, 100, 167, 1)

    s99_gal_Days As gallery.BrowseLayout_Horizontal_TwoTextOneImageVariant_pcfCore:
        AccessibleLabel: =
        BorderColor: =RGBA(0, 18, 107, 1)
        DisplayMode: =DisplayMode.View
        Height: =50
        Items: |+
            =With( { 
                startDate: DateAdd( s99_dtp_StartWeekDate.SelectedDate, -Value(s99_DiffMonday.Text))
            },
            ForAll( Sequence(7,0), 
            With({ 
                week_date: DateAdd( startDate, Value, TimeUnit.Days ) 
            },
            {
                Date: week_date,
                Day: Day(week_date),
                WeekDay: CommonUtils.GetWeekDayText(week_date)
            })))
            
            
        ShowScrollbar: =false
        TemplatePadding: =0
        TemplateSize: =100
        Width: =809
        X: =420
        Y: =83
        ZIndex: =1

        s99_lbl_Day As label:
            Align: =Align.Center
            BorderColor: =RGBA(0, 18, 107, 1)
            Color: =If( Or(ThisItem.WeekDay = "Sun",ThisItem.WeekDay = "Sat"), Color.Red, Color.Black )
            DisabledColor: =RGBA(166, 166, 166, 1)
            DisplayMode: |-
                =With({
                    week: Value(s99_txt_WeekNumber.Text)
                },    
                If( CommonUtils.GetWeekNumber(ThisItem.Date) = week, DisplayMode.View, DisplayMode.Disabled )
                )
            FontWeight: =FontWeight.Bold
            Height: =Parent.TemplateHeight
            OnSelect: =Select(Parent)
            PaddingBottom: =0
            PaddingTop: =0
            Size: =gStyles.FontSize
            Text: =ThisItem.Day & Char(10) & ThisItem.WeekDay & " " & Year(ThisItem.Date)
            Width: =100
            ZIndex: =5

    Container1 As groupContainer.horizontalAutoLayoutContainer:
        Height: =68
        LayoutMode: =LayoutMode.Auto
        Width: =1365
        ZIndex: =2

        Label2_2 As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(37, 36, 35, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(200, 198, 196, 1)
            FocusedBorderThickness: =2
            Font: =Font.'Segoe UI'
            Size: =10.5
            Text: ="Start Date"
            Width: =80
            X: =515
            Y: =28
            ZIndex: =1

        s99_dtp_StartDate As datepicker:
            BorderColor: =RGBA(243, 242, 241, 1)
            CalendarHeaderFill: =ColorFade(RGBA(98, 100, 167, 1), -30%)
            Color: =RGBA(37, 36, 35, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(200, 198, 196, 1)
            DisabledFill: =RGBA(243, 242, 241, 1)
            Fill: =RGBA(243, 242, 241, 1)
            FocusedBorderThickness: =2
            Font: =Font.'Segoe UI'
            HoverDateFill: =RGBA(200, 198, 196, 1)
            IconBackground: =RGBA(243, 242, 241, 1)
            IconFill: =RGBA(37, 36, 35, 1)
            PaddingTop: =5
            SelectedDateFill: =RGBA(98, 100, 167, 1)
            Size: =10.5
            Width: =143
            X: =622
            Y: =28
            ZIndex: =2

        Label2 As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(37, 36, 35, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(200, 198, 196, 1)
            FocusedBorderThickness: =2
            Font: =Font.'Segoe UI'
            Size: =10.5
            Text: ="Week Number"
            Width: =107
            X: =764
            Y: =28
            ZIndex: =3

        s99_txt_WeekNumber As text:
            BorderColor: =RGBA(243, 242, 241, 1)
            BorderThickness: =2
            Color: =RGBA(37, 36, 35, 1)
            Default: =1
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(200, 198, 196, 1)
            DisabledFill: =RGBA(243, 242, 241, 1)
            Fill: =RGBA(243, 242, 241, 1)
            FocusedBorderColor: =RGBA(98, 100, 167, 1)
            FocusedBorderThickness: =2
            Font: =Font.'Segoe UI'
            Format: =TextFormat.Number
            HoverBorderColor: =RGBA(243, 242, 241, 1)
            HoverColor: =RGBA(37, 36, 35, 1)
            HoverFill: =RGBA(243, 242, 241, 1)
            PressedBorderColor: =RGBA(98, 100, 167, 1)
            PressedColor: =RGBA(37, 36, 35, 1)
            PressedFill: =RGBA(243, 242, 241, 1)
            RadiusBottomLeft: =3
            RadiusBottomRight: =3
            RadiusTopLeft: =3
            RadiusTopRight: =3
            Size: =10.5
            Width: =52
            X: =871
            Y: =28
            ZIndex: =5

        s99_DiffMonday As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(37, 36, 35, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(200, 198, 196, 1)
            FocusedBorderThickness: =2
            Font: =Font.'Segoe UI'
            FontWeight: =FontWeight.Bold
            PaddingLeft: =15
            Size: =10.5
            Text: =Weekday(Date(Year(s99_dtp_StartDate.SelectedDate),1,1), StartOfWeek.MondayZero)
            X: =20
            Y: =308
            ZIndex: =8

        Label2_3 As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(37, 36, 35, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(200, 198, 196, 1)
            FocusedBorderThickness: =2
            Font: =Font.'Segoe UI'
            Size: =10.5
            Text: ="Start Week Date"
            Width: =120
            X: =515
            Y: =28
            ZIndex: =9

        s99_dtp_StartWeekDate As datepicker:
            BorderColor: =RGBA(243, 242, 241, 1)
            CalendarHeaderFill: =ColorFade(RGBA(98, 100, 167, 1), -30%)
            Color: =RGBA(37, 36, 35, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisabledColor: =RGBA(200, 198, 196, 1)
            DisabledFill: =RGBA(243, 242, 241, 1)
            Fill: =RGBA(243, 242, 241, 1)
            FocusedBorderThickness: =2
            Font: =Font.'Segoe UI'
            HoverDateFill: =RGBA(200, 198, 196, 1)
            IconBackground: =RGBA(243, 242, 241, 1)
            IconFill: =RGBA(37, 36, 35, 1)
            PaddingTop: =5
            SelectedDateFill: =RGBA(98, 100, 167, 1)
            Size: =10.5
            Width: =143
            X: =107
            Y: =28
            ZIndex: =10

    Container2 As groupContainer.verticalAutoLayoutContainer:
        Height: =695
        LayoutDirection: =LayoutDirection.Vertical
        LayoutGap: =15
        LayoutMode: =LayoutMode.Auto
        Width: =358
        Y: =68
        ZIndex: =3

        s99_lbl_GetWeekNumber_1 As Label:
            DisplayMode: =DisplayMode.View
            FontWeight: =FontWeight.Semibold
            Height: =38
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            Text: =$"GetWeekNumber({Year(s99_dtp_StartDate.SelectedDate)}) = {s99_CCommonUtils.GetWeekNumber(Year(s99_dtp_StartDate.SelectedDate))}"
            Width: =250
            X: =20
            Y: =128
            ZIndex: =1

        s99_lbl_GetWeekNumber_3 As Label:
            DisplayMode: =DisplayMode.View
            FontWeight: =FontWeight.Semibold
            Height: =38
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            Text: |-
                =With({
                    day: Date(Year(s99_dtp_StartDate.SelectedDate),1,1)
                },
                $"GetWeekNumber({day}) = {s99_CCommonUtils.GetWeekNumber(day)}")
            Width: =250
            X: =35
            Y: =252
            ZIndex: =2

        s99_lbl_WeekNum As Label:
            DisplayMode: =DisplayMode.View
            FontWeight: =FontWeight.Semibold
            Height: =38
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            Text: |-
                =With({
                    day: Date(Year(s99_dtp_StartDate.SelectedDate),1,1)
                },$"WeekNum({day}) = {WeekNum(day)}")
            Width: =250
            X: =20
            Y: =59
            ZIndex: =3

        s99_lbl_WeekNum_2 As Label:
            DisplayMode: =DisplayMode.View
            FontWeight: =FontWeight.Semibold
            Height: =38
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            Text: |-
                =With({
                    day: Date(Year(s99_dtp_StartDate.SelectedDate),1,1)
                },$"ISOWeekNum({day}) = {ISOWeekNum(day)}")
            Width: =250
            X: =20
            Y: =59
            ZIndex: =4

        s99_lbl_WeekNum_1 As Label:
            DisplayMode: =DisplayMode.View
            FontWeight: =FontWeight.Semibold
            Height: =38
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            Text: =$"WeekNum({s99_dtp_StartDate.SelectedDate}) = {WeekNum(s99_dtp_StartDate.SelectedDate)}"
            Width: =250
            X: =20
            Y: =59
            ZIndex: =5

        s99_lbl_WeekNum_3 As Label:
            DisplayMode: =DisplayMode.View
            FontWeight: =FontWeight.Semibold
            Height: =38
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            Text: =$"ISOWeekNum({s99_dtp_StartDate.SelectedDate}) = {ISOWeekNum(s99_dtp_StartDate.SelectedDate)}"
            Width: =250
            X: =20
            Y: =59
            ZIndex: =6

        s99_lbl_GetWeekNumber As Label:
            DisplayMode: =DisplayMode.View
            FontWeight: =FontWeight.Semibold
            Height: =38
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            Text: =$"GetWeekNumber({s99_dtp_StartDate.SelectedDate}) = {s99_CCommonUtils.GetWeekNumber(s99_dtp_StartDate.SelectedDate)}"
            Width: =250
            X: =20
            Y: =98
            ZIndex: =7

    s99_CCommonUtils As CCommonUtils:
        GetCurrentWeekNumber: |-
            =With({
                dateToEvaluate: Today(),
                adjustment: If( ISOWeekNum( Date(pYear,1,1) ) > 1, 1, 0)
            },
            If( Year(dateToEvaluate) = pYear,
                WeekNum(dateToEvaluate) + adjustment
            /*
                With({
                        date1: Date(
                            Year(dateToEvaluate - Weekday(dateToEvaluate - 1) + 4),
                            1,
                            3
                        )
                    },
                    With({
                            rup: RoundUp( dateToEvaluate - date1, 0),
                            wd: Weekday(date1) + 5
                        },
                        RoundDown( (rup + wd) / 7, 0 ) + 1
                    )
                )*/,
                1
            ))
        GetDateFromWeekNumber: |
            =//
            // http://powerappsguide.com/blog/post/get-start-date-from-week-number
            //
            With({weekDate: DateAdd(Date(pYear,1,1), 7* pWeekNumber)},
                DateAdd(weekDate,
                        -(Weekday(weekDate)),
                        TimeUnit.Days
                )
            )
        GetWeekDayText: =Switch(Weekday( Date ), 1, "Sun", 2, "Mon", 3, "Tue", 4, "Wed", 5, "Thu", 6, "Fri", 7, "Sat") 
        GetWeekNumber: |-
            =With({
                adjustment: If( ISOWeekNum( Date(Year(Date),1,1) ) > 1, 1, 0)
            },
            WeekNum( Date ) + adjustment )
            // WeekNum( Date , StartOfWeek.Monday )
            // ISOWeekNum( Date )
        Height: =5
        IsWorkingHoursValid: =And( Minutes > 0, Minutes < 24*60 )
        Width: =74
        X: =1291
        Y: =763
        ZIndex: =4

